<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewModels="clr-namespace:MauiMySQLDemo.ViewModels"
             x:Class="MauiMySQLDemo.Views.MenuPage"
             BackgroundColor="#F5F7FA"
             Title="Menu">

    <ContentPage.BindingContext>
        <viewModels:MenuViewModel />
    </ContentPage.BindingContext>

    <ContentPage.Resources>
        <Style x:Key="CardStyle" TargetType="Frame">
            <Setter Property="CornerRadius" Value="16" />
            <Setter Property="HasShadow" Value="True" />
            <Setter Property="BorderColor" Value="Transparent" />
            <Setter Property="BackgroundColor" Value="White" />
            <Setter Property="Padding" Value="18" />
            <Setter Property="Margin" Value="6" />
            <Setter Property="HeightRequest" Value="230" />
        </Style>
        
        <Style x:Key="TitleStyle" TargetType="Label">
            <Setter Property="FontAttributes" Value="Bold" />
            <Setter Property="FontSize" Value="18" />
            <Setter Property="TextColor" Value="#262E3E" />
            <Setter Property="LineBreakMode" Value="TailTruncation" />
            <Setter Property="MaxLines" Value="1" />
        </Style>
        
        <Style x:Key="DescriptionStyle" TargetType="Label">
            <Setter Property="FontSize" Value="14" />
            <Setter Property="TextColor" Value="#5E6579" />
            <Setter Property="Margin" Value="0,6,0,0" />
            <Setter Property="LineBreakMode" Value="TailTruncation" />
            <Setter Property="MaxLines" Value="2" />
        </Style>
        
        <Style x:Key="PriceStyle" TargetType="Label">
            <Setter Property="FontAttributes" Value="Bold" />
            <Setter Property="FontSize" Value="17" />
            <Setter Property="TextColor" Value="#2E7D32" />
            <Setter Property="Margin" Value="0,12,0,0" />
        </Style>
        
        <Style x:Key="AddToCartButtonStyle" TargetType="Button">
            <Setter Property="BackgroundColor" Value="#FF5252" />
            <Setter Property="TextColor" Value="White" />
            <Setter Property="FontAttributes" Value="Bold" />
            <Setter Property="CornerRadius" Value="24" />
            <Setter Property="Margin" Value="0,12,0,0" />
            <Setter Property="HeightRequest" Value="44" />
        </Style>
        
        <Style x:Key="PageHeaderStyle" TargetType="Label">
            <Setter Property="FontSize" Value="28" />
            <Setter Property="FontAttributes" Value="Bold" />
            <Setter Property="TextColor" Value="#262E3E" />
            <Setter Property="HorizontalOptions" Value="Start" />
        </Style>
    </ContentPage.Resources>

<ContentPage.ToolbarItems>
    <ToolbarItem Text="Cart" 
                 IconImageSource="cart.png" 
                 Clicked="OnCartClicked" />
    <ToolbarItem Text="Tables"
                 IconImageSource="table.png"
                 Order="Primary"
                 Priority="1"
                 Clicked="OnTablesClicked" />
    <ToolbarItem Text="Stats"
                 IconImageSource="chart.png" 
                 Order="Primary"
                 Priority="2"
                 Clicked="OnStatisticsClicked" />
    <ToolbarItem Text="Profile"
             IconImageSource="profile.png"
             Order="Primary"
             Priority="3"
             Clicked="OnProfileClicked" />
</ContentPage.ToolbarItems>


    <Grid RowDefinitions="Auto,*" Padding="16,18,16,0">
        <Grid ColumnDefinitions="*,Auto" Margin="0,0,0,16">
            <Label Text="Today's Menu" 
                   Style="{StaticResource PageHeaderStyle}" />
                   
            <Frame Grid.Column="1" 
                   BackgroundColor="#FF5252" 
                   CornerRadius="12" 
                   HeightRequest="40" 
                   WidthRequest="40" 
                   Padding="0" 
                   HorizontalOptions="End"
                   VerticalOptions="Center">
                <Image Source="cart.png" 
                       HeightRequest="24" 
                       WidthRequest="24" 
                       HorizontalOptions="Center" 
                       VerticalOptions="Center" />
                <Frame.GestureRecognizers>
                    <TapGestureRecognizer Tapped="OnCartClicked" />
                </Frame.GestureRecognizers>
            </Frame>
        </Grid>
               
        <CollectionView Grid.Row="1" 
                        ItemsSource="{Binding Plats}"
                        SelectionMode="None"
                        Margin="0,6,0,0">
            <CollectionView.ItemsLayout>
                <GridItemsLayout Orientation="Vertical" 
                                 Span="2" 
                                 HorizontalItemSpacing="10" 
                                 VerticalItemSpacing="18" />
            </CollectionView.ItemsLayout>
            
            <CollectionView.ItemTemplate>
                <DataTemplate>
                   <Frame Style="{StaticResource CardStyle}">
    <Grid RowSpacing="4"
          RowDefinitions="Auto,Auto,Auto,Auto,Auto"> <!-- Add an extra row for Details -->

        <!-- Category tag -->
        <Border Grid.Row="0"
                StrokeShape="RoundRectangle 8"
                BackgroundColor="#FFF3E0"
                StrokeThickness="0"
                HeightRequest="6"
                WidthRequest="40"
                HorizontalOptions="Start"
                Margin="0,0,0,10" />

        <Label Text="{Binding Name}"
               Style="{StaticResource TitleStyle}"
               Grid.Row="0"
               Margin="0,16,0,0" />

        <Label Text="{Binding Description}"
               Style="{StaticResource DescriptionStyle}"
               Grid.Row="1" />

        <Label Text="{Binding Price, StringFormat='{0} MAD'}"
               Style="{StaticResource PriceStyle}"
               Grid.Row="2" />

<HorizontalStackLayout Grid.Row="3" Spacing="8">
    <Button Text="Add to Cart"
            Style="{StaticResource AddToCartButtonStyle}"
            Command="{Binding Source={RelativeSource AncestorType={x:Type viewModels:MenuViewModel}}, Path=AddToCartCommand}"
            CommandParameter="{Binding}" />

    <Button Text="Details"
            Style="{StaticResource AddToCartButtonStyle}"
            Command="{Binding Source={RelativeSource AncestorType={x:Type viewModels:MenuViewModel}}, Path=ShowDetailsCommand}"
            CommandParameter="{Binding}" />
</HorizontalStackLayout>

    </Grid>
</Frame>

                </DataTemplate>
            </CollectionView.ItemTemplate>
            
            <CollectionView.EmptyView>
                <StackLayout VerticalOptions="CenterAndExpand" HorizontalOptions="CenterAndExpand">
                    <Label Text="No items available" 
                           FontSize="18" 
                           TextColor="#5E6579" 
                           HorizontalOptions="Center" />
                </StackLayout>
            </CollectionView.EmptyView>
        </CollectionView>
    </Grid>
</ContentPage>